<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8"  />
	<meta name="description" content="Kyle Halladay Game Development" />
	<meta name="keywords" content="life,code,software,development,games,ludology,indie" />
	<link rel="stylesheet" type="text/css" href="/css/default.css" />
	<link rel="stylesheet" type="text/css" href="/css/pretty_code.css" />
	<link rel="stylesheet" href="/css/highlight_default.css">
	<script src="/javascripts/highlight.pack.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>

<title>Kyle Halladay - Toronto Game Developer</title>
</head>

<body>
	<div id="wrap">
		<div id="header">
			<p id="toplinks">
			</p>
			<h1><a href="/" class="logo"><div id="logo"></div></a><a href="/" class="logo">K</a><a href="/" class="logo">y</a><a href="/" class="logo">l</a><a href="/" class="logo">e</a> <a href="/" class="logo">H</a><a href="/" class="logo">a</a><a href="/" class="logo">l</a><a href="/" class="logo">l</a><a href="/" class="logo">a</a><a href="/" class="logo">d</a><a href="/" class="logo">a</a><a href="/" class="logo">y</a></h1>
			<div class="slogan"> 
					<a href="/" class="paleorange">Home</a> ||
					<a href="/archive.html" class="paleorange">Archive</a> ||
					<a href="/portfolio.html" class="paleorange">Games</a> ||
					<a href="/graphics.html" class="paleorange">Graphics</a> ||
					<a href="/aboutme.html" class="paleorange">About Me</a>
			</div>
	</div>
<div id="content">  
  <span class = "post_title">
<h2>Unit Testing Shaders with UUnit-SL</h2>
</span>

<div id="post">
<br>
<p>tldr? Check out UUnit-SL <a href="https://github.com/khalladay/uunit-sl">on github</a>.</p>

<p>Note: I’m not sure any of the following is useful or a good idea at all, but I think it’s interesting enough to share anyways.</p>

<p>A major concern I have with unit tests is that there doesn’t seem to be an accepted way to test shaders. A common argument against this is that shaders are usually small enough to not need tests. I disagree, especially when it comes to implementing complex math within a shader. Also, if shaders can’t be tested properly, that means a good portion of the work I do can’t be tested, which is a shame.</p>

<p>So I’ve decided to try my hand at building a way to test shaders. I’m still on the fence about this whole thing, but if you’re interested, all the details are here!</p>
<h2>Introducing My Frankenstein: UUnit-SL</h2>
<p><a href="http://wiki.unity3d.com/index.php?title=UUnit">UUnit</a> is a common recommendation given on the forums as a place to start when trying to add testing to Unity projects. It doesn’t have a lot of bells and whistles, but so far it seems to get the job done pretty well. So for this experiment, I’ve decided to nextend UUnit to work with shaders.</p>

<p>To test a shader with UUnit-SL, your test case must derive from the new class UUnitShaderTestCase. If you check out the code you’ll notice a few new methods being defined. The first two are:</p>
<pre><code>
protected virtual void SLSceneSetup()
{
	_oldSceneName = EditorApplication.currentScene;
	EditorApplication.NewScene();

	cameraOutput = new RenderTexture(512,512,0,RenderTextureFormat.ARGB32);

	Camera.main.transform.position = new Vector3(0.0f, 0.0f, -10.0f);
	Camera.main.transform.LookAt(Vector3.zero);
	Camera.main.fieldOfView = 10;
	Camera.main.targetTexture = cameraOutput;
	testCamera = Camera.main.gameObject;
	Camera.main.enabled = false;

	testLight = new GameObject();
	testLight.name = "TestLight";
	testLight.AddComponent&lt;Light&rt;();
	testLight.GetComponent&lt;Light>&rt;.type = LightType.Directional;
	testLight.transform.position = new Vector3(5.0f, 10.0f, -10.0f);
	testLight.transform.LookAt(Vector3.zero);

	testQuad = GameObject.CreatePrimitive(PrimitiveType.Quad);
	testQuad.name = "TestQuad";
	testQuad.transform.position = Vector3.zero;
}
	
protected void SLSceneTearDown()
{
	RenderTexture.active = null;
	GameObject.DestroyImmediate(testCamera);
	GameObject.DestroyImmediate(testLight);
	GameObject.DestroyImmediate(testQuad);
	EditorApplication.OpenScene(_oldSceneName);
}
</code>
</pre>
<p>As you may have gathered, these methods create and tear down a simple scene with a single quad in front of the camera. This quad will eventually hold a material using the shader to be tested. The camera then renders its view to texture and gets the colour of the center pixels in this texture. This output can then be tested against the expected output of the shader given these inputs.</p>

<p>This isn’t useful for testing things like incorrect inputs, or zfighting issues, but it is useful for ensuring that your math is producing the output you expect, which is something. A simple test case using UUnit-SL looks like this:</p>
<pre><code>
public class TestCaseBlue : UUnitShaderTestCase 
{
protected override void SetUp ()
{
	LoadShader("Assets/UUnit-SL/UUnit-SL-SelfTest/UUSLTestBlue.shader");
}

[UUnitTest]
public void TestDiffuse()
{
	UUnitAssert.True(shaderOutput == Color.blue, 
					"Test Blue Output is Blue");
}

protected override void TearDown ()
{
}
}
</code></pre>
<p>If you’ve used UUnit before, you’ll recognize this. The only real difference is the call to LoadShader, which specifies the file path of the shader you want to test. All of the elements in the scene are also exposed as protected variables, so if you want to change their location or settings (a different light type for instance) you can do it inside of SetUp as well. The camera will render to texture after SetUp is called.</p>

<p>As shown above, the colour of the shader otuput is stored in a variable called shaderOutput. At the moment, the tests only store a single pixel of data, although I’m sure that I will find a reason to add other options here pretty quickly if any of this actually proves useful; I’ve yet to decide whether this is actually worth the time to do at all, or if this approach will be too limited for more complex cases.</p>

<p>In any case, UUnit-SL can be grabbed <a href="https://github.com/khalladay/uunit-sl">from github</a>.</p>

<p>Think this is a terrible idea? Think it’s the best thing since sliced bread? Send me a message <a href="http://twitter.com/khalladay">on twitter</a>.</p>
</div>


<div id="related">
  <h3>Recent Posts</h3>
  <ul class="posts">
    
      <li><span>27 Jun 2014</span> &raquo; <a href="/all/blog/2014/06/27/Compute-Shaders-Are-Nifty+copy.html">Getting Started With Compute Shaders In Unity</a></li>
    
      <li><span>16 May 2014</span> &raquo; <a href="/all/blog/2014/05/16/Coloured-Shadows-In-Unity.html">Colouring Shadows in Unity</a></li>
    
      <li><span>05 Apr 2014</span> &raquo; <a href="/all/blog/2014/04/05/Writing-Shaders-For-Deferred-Lighting-Unity.html">Writing Shaders for Deferred Lighting in Unity3D</a></li>
    
      <li><span>30 Mar 2014</span> &raquo; <a href="/all/blog/2014/03/30/Placing-Objects-On-A-Spline.html">A Spline Based Object Placement Tool</a></li>
    
      <li><span>24 Mar 2014</span> &raquo; <a href="/all/blog/2014/03/24/Bacon-Jam-And-Vertex-Colours.html">On Bacon Jam and Grilling Virtual Meat</a></li>
    
      <li><span>18 Feb 2014</span> &raquo; <a href="/all/blog/2014/02/18/Fresnel-Shaders-From-The-Ground-Up.html">The Basics of Fresnel Shading</a></li>
    
      <li><span>08 Feb 2014</span> &raquo; <a href="/all/blog/2014/02/08/Introducing-UUNit-SL-unit-testing-for-shaders.html">Unit Testing Shaders with UUnit-SL</a></li>
    
      <li><span>12 Jan 2014</span> &raquo; <a href="/all/blog/2014/01/12/Runtime-Shader-Compilation-Unity.html">Creating GLSL Shaders at Runtime in Unity3D</a></li>
    
      <li><span>06 Jan 2014</span> &raquo; <a href="/all/blog/2014/01/06/Hacking-My-Attention-Span.html">Automating SelfControl in OS X Mavericks</a></li>
    
      <li><span>24 Dec 2013</span> &raquo; <a href="/all/blog/2013/12/24/Ray-Sphere-Intersection.html">Ray-Sphere Intersection with Simple Math</a></li>
    
  </ul>
</div>

<br>
<br>
</div>

<div id="footer">

	<a href="mailto:k.mj.halladay@gmail.com" class="footerlink">E-mail</a> |
	<a href="https://github.com/khalladay" class="footerlink">Github</a> |
    <a href="http://ca.linkedin.com/pub/kyle-halladay/2b/658/a14/" class="footerlink">LinkedIn</a> |
	<a href="https://www.shadertoy.com/user/khalladay" class="footerlink">ShaderToy</a> |
    <a href="http://twitter.com/khalladay" class="footerlink">Twitter</a>

<p>&copy; 2013 <a href="/aboutme.html" class="footerlink">Kyle Halladay</a>

</div>
</div>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-40292745-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>

